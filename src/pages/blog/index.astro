---
import { getCollection } from "astro:content";
import { ArrowUpRight } from "lucide-astro";
import Layout from "../../layouts/Layout.astro";

const allPosts = await getCollection("blog");
const sortedPosts = allPosts.sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime()
);
---

<Layout title="Blog - Martin HÃ¸st Normark">
  <main class="flex-grow max-w-2xl mx-auto px-6 py-16 md:py-24">
    <div class="animate-fade-in-up mb-12">
      <h1 class="text-2xl font-bold tracking-tight mb-2">Blog</h1>
      <p class="text-sm text-muted-foreground">Thoughts on engineering, ML, and building things.</p>
    </div>

    <ul class="space-y-1">
      {
        sortedPosts.map((post, i) => (
          <li class={`animate-fade-in-up delay-${Math.min(i + 1, 5)}`}>
            <a
              href={"/blog/" + post.slug}
              class="group flex items-baseline justify-between gap-4 py-3 border-b border-border/30 hover:border-primary/30 transition-colors duration-300"
            >
              <div class="flex items-center gap-3 min-w-0">
                <span class="text-foreground/90 group-hover:text-primary transition-colors duration-300 truncate">
                  {post.data.title}
                </span>
                {post.data.type === "link" && (
                  <span class="shrink-0 text-[10px] font-mono uppercase tracking-wider px-2 py-0.5 rounded border border-primary/30 text-primary/70">
                    link
                  </span>
                )}
              </div>
              <time
                datetime={post.data.date.toISOString()}
                class="shrink-0 text-xs font-mono text-muted-foreground tabular-nums"
              >
                {post.data.date.toLocaleDateString("en-US", {
                  year: "numeric",
                  month: "short",
                  day: "numeric",
                })}
              </time>
            </a>
            {post.data.type === "link" && post.data.externalUrl && (
              <a
                href={post.data.externalUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="inline-flex items-center gap-1 text-xs text-muted-foreground hover:text-primary transition-colors duration-300 mt-1 ml-0 font-mono"
              >
                original <ArrowUpRight class="h-3 w-3" />
              </a>
            )}
          </li>
        ))
      }
    </ul>

    <div class="mt-16 pt-8 border-t border-border/30">
      <p class="text-sm text-muted-foreground">
        Older writing on
        <a
          href="https://medium.com/product-hacking"
          target="_blank"
          rel="noopener noreferrer"
          class="text-foreground/70 hover:text-primary transition-colors duration-300 underline underline-offset-4 decoration-border hover:decoration-primary"
        >
          Medium / Product Hacking
        </a>
      </p>
    </div>
  </main>
</Layout>
